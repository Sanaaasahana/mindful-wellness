<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindfulSpace - Home</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="main-body">
    <div class="floating-leaves">
        <div class="leaf leaf-1">üçÉ</div>
        <div class="leaf leaf-2">üåø</div>
        <div class="leaf leaf-3">üçÉ</div>
        <div class="leaf leaf-4">üåø</div>
        <div class="leaf leaf-5">üçÉ</div>
        <div class="leaf leaf-6">üå±</div>
    </div>

    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h2>MindfulSpace</h2>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="home.html" class="menu-item active">
                <i class="fas fa-home"></i> Home
            </a></li>
            <li><a href="journal.html" class="menu-item">
                <i class="fas fa-book"></i> Journal
            </a></li>
            <li><a href="support.html" class="menu-item">
                <i class="fas fa-users"></i> Support Group
            </a></li>
            <li><a href="connect.html" class="menu-item">
                <i class="fas fa-user-friends"></i> Connect
            </a></li>
            <li><a href="profile.html" class="menu-item">
                <i class="fas fa-user"></i> Profile
            </a></li>
            <li><a href="#" onclick="logout()" class="menu-item logout">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a></li>
        </ul>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1>Welcome back, <span id="user-name-display"></span>! üå∏</h1>
            <p>How are you feeling in this beautiful moment?</p>
        </div>

        <div class="home-grid">
            <!-- Mood Tracker -->
            <div class="card mood-tracker">
                <h3><i class="fas fa-heart"></i> Today's Mood</h3>
                <div class="mood-options">
                    <button class="mood-btn" onclick="setMood('üòä', 'happy')" data-mood="happy">
                        üòä Happy
                    </button>
                    <button class="mood-btn" onclick="setMood('üò¢', 'sad')" data-mood="sad">
                        üò¢ Sad
                    </button>
                    <button class="mood-btn" onclick="setMood('üò∞', 'anxious')" data-mood="anxious">
                        üò∞ Anxious
                    </button>
                    <button class="mood-btn" onclick="setMood('üò¥', 'tired')" data-mood="tired">
                        üò¥ Tired
                    </button>
                    <button class="mood-btn" onclick="setMood('üòå', 'calm')" data-mood="calm">
                        üòå Calm
                    </button>
                    <button class="mood-btn" onclick="setMood('üò§', 'angry')" data-mood="angry">
                        üò§ Angry
                    </button>
                </div>
                <div id="mood-feedback" class="mood-feedback"></div>
            </div>

            <!-- Gratitude -->
            <div class="card gratitude">
                <h3><i class="fas fa-heart"></i> Gratitude Garden</h3>
                <p class="gratitude-subtitle">What are you grateful for today?</p>
                <textarea id="gratitude-input" placeholder="I'm grateful for..."></textarea>
                <button onclick="saveGratitude()" class="btn-primary">
                    <i class="fas fa-seedling"></i> Plant Gratitude
                </button>
                <div id="gratitude-list" class="gratitude-list"></div>
            </div>

            <!-- Mood Calendar -->
            <div class="card mood-calendar">
                <h3><i class="fas fa-calendar-alt"></i> Mood Calendar</h3>
                <div id="calendar" class="calendar"></div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        // Check authentication
        checkAuth();
        
        // Load user data
        loadUserData();
        generateCalendar();
        loadGratitudes();
        updateTodayMood();

        function setMood(emoji, mood) {
            const today = new Date().toDateString();
            const currentUser = getCurrentUser();
            let moods = JSON.parse(localStorage.getItem('mindful_moods')) || {};
            
            if (!moods[currentUser.id]) moods[currentUser.id] = {};
            moods[currentUser.id][today] = { emoji, mood, timestamp: new Date().toISOString() };
            localStorage.setItem('mindful_moods', JSON.stringify(moods));
            
            document.getElementById('mood-feedback').innerHTML = `
                <div class="mood-response">
                    <p>You're feeling ${mood} today ${emoji}</p>
                    <p class="mood-tip">${getMoodTip(mood)}</p>
                </div>
            `;
            
            // Update mood buttons
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-mood="${mood}"]`).classList.add('selected');
            
            generateCalendar();
        }

        function getMoodTip(mood) {
            const tips = {
                happy: "That's wonderful! üåü Consider sharing your joy with someone special or write about what made you happy today.",
                sad: "It's okay to feel sad. ü§ó Remember, this feeling will pass. Consider talking to someone you trust or practicing self-care.",
                anxious: "Take deep breaths. üå¨Ô∏è Try some grounding exercises: name 5 things you can see, 4 you can touch, 3 you can hear.",
                tired: "Rest is important. üò¥ Make sure you're getting enough sleep and taking breaks. Your body is telling you something.",
                calm: "Beautiful! üßò‚Äç‚ôÄÔ∏è This is a perfect time for reflection, meditation, or planning your day mindfully.",
                angry: "It's normal to feel angry sometimes. üî• Try some physical exercise, deep breathing, or journaling to process these feelings."
            };
            return tips[mood] || "Remember to be kind to yourself. üíö";
        }

        function saveGratitude() {
            const gratitudeText = document.getElementById('gratitude-input').value.trim();
            if (!gratitudeText) return;

            const today = new Date().toDateString();
            const currentUser = getCurrentUser();
            let gratitudes = JSON.parse(localStorage.getItem('mindful_gratitudes')) || {};
            
            if (!gratitudes[currentUser.id]) gratitudes[currentUser.id] = {};
            if (!gratitudes[currentUser.id][today]) gratitudes[currentUser.id][today] = [];
            
            gratitudes[currentUser.id][today].push({
                text: gratitudeText,
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('mindful_gratitudes', JSON.stringify(gratitudes));
            document.getElementById('gratitude-input').value = '';
            loadGratitudes();
            
            // Show success message
            showNotification('Gratitude planted in your garden! üå±', 'success');
        }

        function loadGratitudes() {
            const today = new Date().toDateString();
            const currentUser = getCurrentUser();
            const gratitudes = JSON.parse(localStorage.getItem('mindful_gratitudes')) || {};
            const todayGratitudes = gratitudes[currentUser.id]?.[today] || [];
            
            const gratitudeList = document.getElementById('gratitude-list');
            gratitudeList.innerHTML = todayGratitudes.map(g => `
                <div class="gratitude-item">
                    <div class="gratitude-icon">üå∏</div>
                    <div class="gratitude-content">
                        <p>${g.text}</p>
                        <small>${new Date(g.timestamp).toLocaleTimeString()}</small>
                    </div>
                </div>
            `).join('');
        }

        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const currentUser = getCurrentUser();
            const moods = JSON.parse(localStorage.getItem('mindful_moods')) || {};
            const userMoods = moods[currentUser.id] || {};
            
            let calendarHTML = `
                <div class="calendar-header">
                    <h4>${today.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</h4>
                </div>
                <div class="calendar-grid">
                    <div class="day-header">Sun</div>
                    <div class="day-header">Mon</div>
                    <div class="day-header">Tue</div>
                    <div class="day-header">Wed</div>
                    <div class="day-header">Thu</div>
                    <div class="day-header">Fri</div>
                    <div class="day-header">Sat</div>
            `;
            
            // Empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                calendarHTML += '<div class="calendar-day empty"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateString = date.toDateString();
                const dayMood = userMoods[dateString];
                const isToday = dateString === today.toDateString();
                
                calendarHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" title="${dayMood ? `Feeling ${dayMood.mood}` : 'No mood recorded'}">
                        <span class="day-number">${day}</span>
                        ${dayMood ? `<span class="day-mood">${dayMood.emoji}</span>` : ''}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendar.innerHTML = calendarHTML;
        }

        function updateTodayMood() {
            const today = new Date().toDateString();
            const currentUser = getCurrentUser();
            const moods = JSON.parse(localStorage.getItem('mindful_moods')) || {};
            const todayMood = moods[currentUser.id]?.[today];
            
            if (todayMood) {
                document.querySelector(`[data-mood="${todayMood.mood}"]`)?.classList.add('selected');
                document.getElementById('mood-feedback').innerHTML = `
                    <div class="mood-response">
                        <p>You're feeling ${todayMood.mood} today ${todayMood.emoji}</p>
                        <p class="mood-tip">${getMoodTip(todayMood.mood)}</p>
                    </div>
                `;
            }
        }

        function loadUserData() {
            const currentUser = getCurrentUser();
            document.getElementById('user-name-display').textContent = currentUser.name;
        }
    </script>
</body>
</html>
